%interact matlab with simulink
clc;clear;close all ;
format short
%uiopen('E:\FE project\all codes\matlab simulink\power_PVarray_250kWmod.slx',1)
%sim
%define model constant
simout1=zeros(1,30);
for i=1:2%10:50
    disp(i)
%Ir=0:1000
%rf=0.001:2000ohm
T=randi([10,35],1);%1-var
IR=randi([100,1000],1);%2-var
LOC=26;%3-var
%LOC=0;%normal condition
RF=randi([1,2000],1);%4-var
%RF=10000;%normal condition
%tsample=0.0005;
tfinal=0.4;%sim stop time %5-var
%samplet=Auto;%sample time 2*0.005
timef=0.2;%fault time
%simulation
a=sim('E:\FE project\all codes\matlab simulink\power_PVarray_250kWmodfault3','SimulationMode','normal');
%extract data generated by simulink model
I1 = a.get('I1');
I2 = a.get('I2');
I3 = a.get('I3');
I4 = a.get('I4');
I5 = a.get('I5');
I6 = a.get('I6');
Pdcmean = a.get('Pdcmean');
Vdcmean = a.get('Vdcmean');
Itotal = a.get('Itotal');
n=length(I1);
hn=floor(n/2);
qn=floor(3*n/4);
m=length(Pdcmean);
hm=floor(m/2);
qm=floor(3*m/4);
%k=length(Itotal);
I11=mean(I1(hn:qn));%6-var 
I22=mean(I2(hn:qn));%7-var 
I1max=max(I1(hn:qn));%8-var 
I1min=min(I1(hn:qn));%9-var
I1var=var(I1(hn:qn));%10-var
I2max=max(I2(hn:qn));%11-var 
I2min=min(I2(hn:qn));%12-var 
I2var=var(I2(hn:qn));%13-var
I33=mean(I3(hn:qn));%14-var 
I44=mean(I4(hn:qn));%15-var 
I3max=max(I3(hn:qn));%16-var 
I3min=min(I3(hn:qn));%17-var
I3var=var(I3(hn:qn));%18-var
I4max=max(I4(hn:qn));%19-var 
I4min=min(I4(hn:qn));%20-var 
I55=mean(I5(hn:qn));%21-var 
I66=mean(I6(hn:qn));%22-var 
Pdcmean1=mean(Pdcmean(hm:qm));%23-var 
Vdcmean1=mean(Vdcmean(hm:qm));%24-var 
Vdcmax1=max(Vdcmean(hm:qm));%25-var 
Vdcmin1=min(Vdcmean(hm:qm));%26-var 
Itotal1=mean(Itotal(hm:qm));%27-var 
Itotalmax1=max(Itotal(hm:qm));%28-var 
Itotalmin1=min(Itotal(hm:qm));%29-var 
%fault types
%normal 0
%string fault 1
%string-to-ground fault 2
%string-to-string-fault 3

%if RF~=inf
    class=3;%abnormal condition string fault %30-var
%else
   % class=0;%normal condition
%end
simout1(i,:)=[I11,I22,I1max,I1min,I1var,I2max,I2min,I2var,I33,I44,I3max,I3min,I3var,I4max,I4min,I55,I66,Itotal1,Itotalmax1,Itotalmin1,Vdcmean1,Vdcmax1,Vdcmin1,Pdcmean1,IR,T,LOC,RF,tfinal,class];
%break
end
%x=24:0.1:31 %temp
%yˆ = -80.4560 + 3.6100x %radiation
title={'''I1','''I2','''I1MAX','''I1MIN','''I1VAR','''I2MAX','''I2MIN','''I2VAR','''I3','''I4','''I3max','''I3min','''I3var','''I4MAX','''I4MIN','''I5','''I6','''Itotal1','''Itotalmax1','''Itotalmin1','''Vdcmean1','''Vdcmax1','''Vdcmin1','''Pdcmean1','''IR','''T','''LOC','''RF','''simstop time','''class'};
filename='G:\workshop\datasettest1.xlsx';
xlswrite(filename,title,'Sheet1','A1')
xlswrite(filename,simout1,'Sheet1','A2')
winopen(filename);