%interact matlab with simulink
clc;clear;close all ;
format short
%uiopen('C:\Users\amr rashed\Desktop\Matlab\solar project\power_PVarray_250kWmod.slx',1)
%sim
filename='dbsolarx2.csv';
%define model constant
%Elapsed time is 7572.813306 seconds for 75 samples
%Elapsed time is 10380.808216 seconds for 75 samples
simout1=zeros(1,30);
tic
for i=1:24
    disp(i)
T=randi([10,35],1);%1-var
IR=randi([100,1000],1);%2-var
LOC=58;%3-var
RF=randi([0,1000],1);%4-var
%tsample=0.0005;
tfinal=0.4;%sim stop time %5-var
%samplet=Auto;%sample time 2*0.005
timef=0.2;%fault time
%simulation
a=sim('power_PVarray_250kWmod','SimulationMode','normal');
%extract data generated by simulink model
I1 = a.get('I1');
I2 = a.get('I2');
I3 = a.get('I3');
I4 = a.get('I4');
I5 = a.get('I5');
I6 = a.get('I6');
Pdcmean = a.get('Pdcmean');
Vdcmean = a.get('Vdcmean');
Itotal = a.get('Itotal');

n=length(I1);
hn=floor(n/2);
qn=floor(3*n/4);
m=length(Pdcmean);
hm=floor(m/2);
qm=floor(3*m/4);

%k=length(Itotal);
I11=mean(I1(hn:n));%6-var 
I22=mean(I2(hn:n));%7-var 
I1max=max(I1(hn:n));%8-var 
I1min=min(I1(hn:n));%9-var
I1var=var(I1(hn:n));%10-var
I2max=max(I2(hn:n));%11-var 
I2min=min(I2(hn:n));%12-var 
I2var=var(I2(hn:n));%13-var
I33=mean(I3(hn:n));%14-var 
I44=mean(I4(hn:n));%15-var 
I3max=max(I3(hn:n));%16-var 
I3min=min(I3(hn:n));%17-var
I3var=var(I3(hn:n));%18-var
I4max=max(I4(hn:n));%19-var 
I4min=min(I4(hn:n));%20-var 
I55=mean(I5(hn:n));%21-var 
I66=mean(I6(hn:n));%22-var 
Pdcmean1=mean(Pdcmean(hm:m));%23-var 
Vdcmean1=mean(Vdcmean(hm:m));%24-var 
Vdcmax1=max(Vdcmean(hm:m));%25-var 
Vdcmin1=min(Vdcmean(hm:m));%26-var 
Itotal1=mean(Itotal(hm:m));%27-var 
Itotalmax1=max(Itotal(hm:m));%28-var 
Itotalmin1=min(Itotal(hm:m));%29-var 
%fault types
%normal 0
%string fault 1
%string-to-ground fault 2
%string-to-string-fault 3
%%%%% remove this case short circuit rf=0 4 
% if RF~=inf
%     class=1;%abnormal condition string fault %30-var
% else
%     class=0;%normal condition
% end
class=2;
simout1(i,:)=[I11,I22,I1max,I1min,I1var,I2max,I2min,I2var,I33,I44,I3max,I3min,I3var,I4max,I4min,I55,I66,Itotal1,Itotalmax1,Itotalmin1,Vdcmean1,Vdcmax1,Vdcmin1,Pdcmean1,IR,T,LOC,RF,tfinal,class];
dlmwrite(filename,simout1(i,:),'-append','delimiter',',')
end
toc
%x=24:0.1:31 %temp
%yˆ = -80.4560 + 3.6100x %radiation
%title={'''I1 ','''I2 ','''I1MAX ','''I1MIN ','''I1VAR ','''I2MAX ','''I2MIN ','''I2VAR ','''I3 ','''I4 ','''I3max ','''I3min ','''I3var ','''I4MAX ','''I4MIN ','''I5 ','''I6 ','''Itotal1 ','''Itotalmax1 ','''Itotalmin1 ','''Vdcmean1 ','''Vdcmax1 ','''Vdcmin1 ','''Pdcmean1 ','''IR ','''T ','''LOC ','''RF ','''simstoptime ','''class '};

%dlmwrite(filename,title,'delimiter','')
winopen(filename);