%interact matlab with simulink
clc;clear;close all ;
format short
%uiopen('C:\Users\amr rashed\Desktop\Matlab\solar project\power_PVarray_250kWmod.slx',1)
%sim
%define model constant
i=1;
simout1=zeros(1,27);
for t=31:0.5:31.5%10:50
%Ir=0:1000
%rf=0.001:2000ohm
T=t;
IR=1000;
LOC=1;
RF=5;
%tsample=0.0005;
tfinal=0.2;
%simulation
a=sim('power_PVarray_250kWmod','SimulationMode','normal');
%extract data generated by simulink model
I1 = a.get('I1');
I2 = a.get('I2');
I3 = a.get('I3');
I4 = a.get('I4');
I5 = a.get('I5');
I6 = a.get('I6');
Pdcmean = a.get('Pdcmean');
Vdcmean = a.get('Vdcmean');
Itotal = a.get('Itotal');
n=length(I1);
n=floor(n/2);
m=length(Pdcmean);
m=floor(m/2);
%k=length(Itotal);
I11=mean(I1(n/2:end));
I22=mean(I2(n/2:end));
I1max=max(I1(n/2:end));
I1min=min(I1(n/2:end));
I1med=median(I1(n/2:end));
I1var=var(I1(n/2:end));
I33=mean(I3(n/2:end));
I44=mean(I4(n/2:end));
I3max=max(I3(n/2:end));
I3min=min(I3(n/2:end));
I3med=median(I3(n/2:end));
I3var=var(I3(n/2:end));
I55=mean(I5(n/2:end));
I66=mean(I6(n/2:end));
Pdcmean1=mean(Pdcmean(m/2:end));
Vdcmean1=mean(Vdcmean(m/2:end));
Vdcmax1=max(Vdcmean(m/2:end));
Vdcmin1=min(Vdcmean(m/2:end));
Itotal1=mean(Itotal(n/2:end));
Itotalmax1=max(Itotal(n/2:end));
Itotalmin1=min(Itotal(n/2:end));
%fault types
%normal 0
%string fault 1
%string-to-ground fault 2
%string-to-string-fault 3
%short circuit rf=0 4
if RF~=inf
    class=1;%abnormal condition string fault
else
    class=0;%normal condition
end
simout1(i,:)=[I11,I22,I1max,I1min,I1med,I1var,I33,I44,I3max,I3min,I3med,I3var,I55,I66,Itotal1,Itotalmax1,Itotalmin1,IR,T,Vdcmean1,Vdcmax1,Vdcmin1,Pdcmean1,LOC,RF,tfinal,class];
i=i+1;
end
%title=['I1','I2','I1MAX','I1MIN','I1MED','I1VAR','I3','I4','I3max','I3min','I3med','I3var','I5','I6','Itotal1','IR','T','Vdcmean1','Pdcmean1','LOC','RF','simstop time','class'];
%xlswrite('testdata2.xlsx',title)
xlswrite('testdata3.xlsx',simout1)